{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nexport class CartService {\n  constructor() {\n    this.CART_STORAGE_KEY = 'car_ecommerce_cart';\n    this.cartItemsSubject = new BehaviorSubject([]);\n    this.cartItems$ = this.cartItemsSubject.asObservable();\n    this.cartCount$ = this.cartItems$.pipe(map(items => items.reduce((total, item) => total + item.quantity, 0)));\n    this.cartTotal$ = this.cartItems$.pipe(map(items => items.reduce((total, item) => total + item.car.price * item.quantity, 0)));\n    this.loadCartFromStorage();\n  }\n  loadCartFromStorage() {\n    try {\n      const savedCart = localStorage.getItem(this.CART_STORAGE_KEY);\n      if (savedCart) {\n        const parsedCart = JSON.parse(savedCart);\n        this.cartItemsSubject.next(parsedCart);\n      }\n    } catch (error) {\n      console.error('Error loading cart from storage:', error);\n      this.cartItemsSubject.next([]);\n    }\n  }\n  addToCart(car, quantity = 1) {\n    const currentItems = this.cartItemsSubject.value;\n    const existingItemIndex = currentItems.findIndex(item => item.car.id === car.id);\n    let updatedItems;\n    if (existingItemIndex !== -1) {\n      // Update existing item quantity\n      updatedItems = [...currentItems];\n      updatedItems[existingItemIndex] = {\n        ...updatedItems[existingItemIndex],\n        quantity: updatedItems[existingItemIndex].quantity + quantity\n      };\n    } else {\n      // Add new item\n      updatedItems = [...currentItems, {\n        car,\n        quantity\n      }];\n    }\n    this.cartItemsSubject.next(updatedItems);\n    this.saveCartToStorage();\n  }\n  removeFromCart(carId) {\n    const currentItems = this.cartItemsSubject.value;\n    const updatedItems = currentItems.filter(item => item.car.id !== carId);\n    this.cartItemsSubject.next(updatedItems);\n    this.saveCartToStorage();\n  }\n  updateQuantity(carId, newQuantity) {\n    if (newQuantity <= 0) {\n      this.removeFromCart(carId);\n      return;\n    }\n    const currentItems = this.cartItemsSubject.value;\n    const updatedItems = currentItems.map(item => item.car.id === carId ? {\n      ...item,\n      quantity: newQuantity\n    } : item);\n    this.cartItemsSubject.next(updatedItems);\n    this.saveCartToStorage();\n  }\n  isInCart(carId) {\n    return this.cartItemsSubject.value.some(item => item.car.id === carId);\n  }\n  clearCart() {\n    this.cartItemsSubject.next([]);\n    localStorage.removeItem(this.CART_STORAGE_KEY);\n  }\n  saveCartToStorage() {\n    try {\n      localStorage.setItem(this.CART_STORAGE_KEY, JSON.stringify(this.cartItemsSubject.value));\n    } catch (error) {\n      console.error('Error saving cart to storage:', error);\n    }\n  }\n  static {\n    this.ɵfac = function CartService_Factory(t) {\n      return new (t || CartService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CartService,\n      factory: CartService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","map","CartService","constructor","CART_STORAGE_KEY","cartItemsSubject","cartItems$","asObservable","cartCount$","pipe","items","reduce","total","item","quantity","cartTotal$","car","price","loadCartFromStorage","savedCart","localStorage","getItem","parsedCart","JSON","parse","next","error","console","addToCart","currentItems","value","existingItemIndex","findIndex","id","updatedItems","saveCartToStorage","removeFromCart","carId","filter","updateQuantity","newQuantity","isInCart","some","clearCart","removeItem","setItem","stringify","factory","ɵfac","providedIn"],"sources":["C:\\angular project\\car\\frontend\\car-ecommerce-frontend\\src\\app\\services\\cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { Car } from '../models/car.model';\r\n\r\nexport interface CartItem {\r\n  car: Car;\r\n  quantity: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CartService {\r\n  private readonly CART_STORAGE_KEY = 'car_ecommerce_cart';\r\n  private cartItemsSubject = new BehaviorSubject<CartItem[]>([]);\r\n  cartItems$ = this.cartItemsSubject.asObservable();\r\n\r\n  cartCount$ = this.cartItems$.pipe(\r\n    map(items => items.reduce((total, item) => total + item.quantity, 0))\r\n  );\r\n\r\n  cartTotal$ = this.cartItems$.pipe(\r\n    map(items => items.reduce((total, item) => total + (item.car.price * item.quantity), 0))\r\n  );\r\n\r\n  constructor() {\r\n    this.loadCartFromStorage();\r\n  }\r\n\r\n  private loadCartFromStorage(): void {\r\n    try {\r\n      const savedCart = localStorage.getItem(this.CART_STORAGE_KEY);\r\n      if (savedCart) {\r\n        const parsedCart = JSON.parse(savedCart);\r\n        this.cartItemsSubject.next(parsedCart);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error loading cart from storage:', error);\r\n      this.cartItemsSubject.next([]);\r\n    }\r\n  }\r\n\r\n  addToCart(car: Car, quantity: number = 1): void {\r\n    const currentItems = this.cartItemsSubject.value;\r\n    const existingItemIndex = currentItems.findIndex(item => item.car.id === car.id);\r\n\r\n    let updatedItems: CartItem[];\r\n    if (existingItemIndex !== -1) {\r\n      // Update existing item quantity\r\n      updatedItems = [...currentItems];\r\n      updatedItems[existingItemIndex] = {\r\n        ...updatedItems[existingItemIndex],\r\n        quantity: updatedItems[existingItemIndex].quantity + quantity\r\n      };\r\n    } else {\r\n      // Add new item\r\n      updatedItems = [...currentItems, { car, quantity }];\r\n    }\r\n\r\n    this.cartItemsSubject.next(updatedItems);\r\n    this.saveCartToStorage();\r\n  }\r\n\r\n  removeFromCart(carId: number): void {\r\n    const currentItems = this.cartItemsSubject.value;\r\n    const updatedItems = currentItems.filter(item => item.car.id !== carId);\r\n    this.cartItemsSubject.next(updatedItems);\r\n    this.saveCartToStorage();\r\n  }\r\n\r\n  updateQuantity(carId: number, newQuantity: number): void {\r\n    if (newQuantity <= 0) {\r\n      this.removeFromCart(carId);\r\n      return;\r\n    }\r\n\r\n    const currentItems = this.cartItemsSubject.value;\r\n    const updatedItems = currentItems.map(item =>\r\n      item.car.id === carId ? { ...item, quantity: newQuantity } : item\r\n    );\r\n\r\n    this.cartItemsSubject.next(updatedItems);\r\n    this.saveCartToStorage();\r\n  }\r\n\r\n  isInCart(carId: number): boolean {\r\n    return this.cartItemsSubject.value.some(item => item.car.id === carId);\r\n  }\r\n\r\n  clearCart(): void {\r\n    this.cartItemsSubject.next([]);\r\n    localStorage.removeItem(this.CART_STORAGE_KEY);\r\n  }\r\n\r\n  private saveCartToStorage(): void {\r\n    try {\r\n      localStorage.setItem(this.CART_STORAGE_KEY, JSON.stringify(this.cartItemsSubject.value));\r\n    } catch (error) {\r\n      console.error('Error saving cart to storage:', error);\r\n    }\r\n  }\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}