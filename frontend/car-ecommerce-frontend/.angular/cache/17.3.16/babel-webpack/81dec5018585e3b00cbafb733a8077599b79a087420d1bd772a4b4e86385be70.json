{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nexport class CartService {\n  constructor() {\n    this.cartItemsSubject = new BehaviorSubject([]);\n    this.cartItems$ = this.cartItemsSubject.asObservable();\n    this.cartCount$ = this.cartItems$.pipe(map(items => items.reduce((total, item) => total + item.quantity, 0)));\n    this.cartTotal$ = this.cartItems$.pipe(map(items => items.reduce((total, item) => total + item.car.price * item.quantity, 0)));\n    // Load cart from localStorage on initialization\n    const savedCart = localStorage.getItem('cart');\n    if (savedCart) {\n      try {\n        const parsedCart = JSON.parse(savedCart);\n        this.cartItemsSubject.next(parsedCart);\n      } catch (error) {\n        console.error('Error parsing cart from localStorage:', error);\n        this.cartItemsSubject.next([]);\n      }\n    }\n  }\n  addToCart(car, quantity = 1) {\n    const currentItems = this.cartItemsSubject.value;\n    const existingItemIndex = currentItems.findIndex(item => item.car.id === car.id);\n    let updatedItems;\n    if (existingItemIndex !== -1) {\n      // Update existing item quantity\n      updatedItems = [...currentItems];\n      updatedItems[existingItemIndex] = {\n        ...updatedItems[existingItemIndex],\n        quantity: updatedItems[existingItemIndex].quantity + quantity\n      };\n    } else {\n      // Add new item\n      updatedItems = [...currentItems, {\n        car,\n        quantity\n      }];\n    }\n    this.cartItemsSubject.next(updatedItems);\n    this.saveToLocalStorage();\n  }\n  removeFromCart(carId) {\n    const updatedItems = this.cartItemsSubject.value.filter(item => item.car.id !== carId);\n    this.cartItemsSubject.next(updatedItems);\n    this.saveToLocalStorage();\n  }\n  updateQuantity(carId, quantity) {\n    if (quantity <= 0) {\n      this.removeFromCart(carId);\n      return;\n    }\n    const currentItems = this.cartItemsSubject.value;\n    const updatedItems = currentItems.map(item => item.car.id === carId ? {\n      ...item,\n      quantity\n    } : item);\n    this.cartItemsSubject.next(updatedItems);\n    this.saveToLocalStorage();\n  }\n  isInCart(carId) {\n    return this.cartItemsSubject.value.some(item => item.car.id === carId);\n  }\n  clearCart() {\n    this.cartItemsSubject.next([]);\n    localStorage.removeItem('cart');\n  }\n  saveToLocalStorage() {\n    try {\n      localStorage.setItem('cart', JSON.stringify(this.cartItemsSubject.value));\n    } catch (error) {\n      console.error('Error saving cart to localStorage:', error);\n    }\n  }\n  static {\n    this.ɵfac = function CartService_Factory(t) {\n      return new (t || CartService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CartService,\n      factory: CartService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["BehaviorSubject","map","CartService","constructor","cartItemsSubject","cartItems$","asObservable","cartCount$","pipe","items","reduce","total","item","quantity","cartTotal$","car","price","savedCart","localStorage","getItem","parsedCart","JSON","parse","next","error","console","addToCart","currentItems","value","existingItemIndex","findIndex","id","updatedItems","saveToLocalStorage","removeFromCart","carId","filter","updateQuantity","isInCart","some","clearCart","removeItem","setItem","stringify","factory","ɵfac","providedIn"],"sources":["C:\\angular project\\car\\frontend\\car-ecommerce-frontend\\src\\app\\services\\cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { BehaviorSubject } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\nimport { Car } from '../models/car.model';\r\n\r\nexport interface CartItem {\r\n  car: Car;\r\n  quantity: number;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CartService {\r\n  private cartItemsSubject = new BehaviorSubject<CartItem[]>([]);\r\n  cartItems$ = this.cartItemsSubject.asObservable();\r\n\r\n  cartCount$ = this.cartItems$.pipe(\r\n    map(items => items.reduce((total, item) => total + item.quantity, 0))\r\n  );\r\n\r\n  cartTotal$ = this.cartItems$.pipe(\r\n    map(items => items.reduce((total, item) => total + (item.car.price * item.quantity), 0))\r\n  );\r\n\r\n  constructor() {\r\n    // Load cart from localStorage on initialization\r\n    const savedCart = localStorage.getItem('cart');\r\n    if (savedCart) {\r\n      try {\r\n        const parsedCart = JSON.parse(savedCart);\r\n        this.cartItemsSubject.next(parsedCart);\r\n      } catch (error) {\r\n        console.error('Error parsing cart from localStorage:', error);\r\n        this.cartItemsSubject.next([]);\r\n      }\r\n    }\r\n  }\r\n\r\n  addToCart(car: Car, quantity: number = 1): void {\r\n    const currentItems = this.cartItemsSubject.value;\r\n    const existingItemIndex = currentItems.findIndex(item => item.car.id === car.id);\r\n\r\n    let updatedItems: CartItem[];\r\n    if (existingItemIndex !== -1) {\r\n      // Update existing item quantity\r\n      updatedItems = [...currentItems];\r\n      updatedItems[existingItemIndex] = {\r\n        ...updatedItems[existingItemIndex],\r\n        quantity: updatedItems[existingItemIndex].quantity + quantity\r\n      };\r\n    } else {\r\n      // Add new item\r\n      updatedItems = [...currentItems, { car, quantity }];\r\n    }\r\n\r\n    this.cartItemsSubject.next(updatedItems);\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  removeFromCart(carId: number): void {\r\n    const updatedItems = this.cartItemsSubject.value.filter(item => item.car.id !== carId);\r\n    this.cartItemsSubject.next(updatedItems);\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  updateQuantity(carId: number, quantity: number): void {\r\n    if (quantity <= 0) {\r\n      this.removeFromCart(carId);\r\n      return;\r\n    }\r\n\r\n    const currentItems = this.cartItemsSubject.value;\r\n    const updatedItems = currentItems.map(item =>\r\n      item.car.id === carId ? { ...item, quantity } : item\r\n    );\r\n\r\n    this.cartItemsSubject.next(updatedItems);\r\n    this.saveToLocalStorage();\r\n  }\r\n\r\n  isInCart(carId: number): boolean {\r\n    return this.cartItemsSubject.value.some(item => item.car.id === carId);\r\n  }\r\n\r\n  clearCart(): void {\r\n    this.cartItemsSubject.next([]);\r\n    localStorage.removeItem('cart');\r\n  }\r\n\r\n  private saveToLocalStorage(): void {\r\n    try {\r\n      localStorage.setItem('cart', JSON.stringify(this.cartItemsSubject.value));\r\n    } catch (error) {\r\n      console.error('Error saving cart to localStorage:', error);\r\n    }\r\n  }\r\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}