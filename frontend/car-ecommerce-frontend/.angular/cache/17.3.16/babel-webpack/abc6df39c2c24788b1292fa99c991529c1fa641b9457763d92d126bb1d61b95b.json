{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject, tap, catchError, throwError } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class CartService {\n  constructor(http) {\n    this.http = http;\n    this.apiUrl = `${environment.apiUrl}/api/cart`;\n    this.cartItemsSubject = new BehaviorSubject([]);\n    this.cartItems$ = this.cartItemsSubject.asObservable();\n    this.cartCountSubject = new BehaviorSubject(0);\n    this.cartCount$ = this.cartCountSubject.asObservable();\n    this.totalPriceSubject = new BehaviorSubject(0);\n    this.totalPrice$ = this.totalPriceSubject.asObservable();\n    this.httpOptions = {\n      headers: new HttpHeaders({\n        'Content-Type': 'application/json'\n      }),\n      withCredentials: true\n    };\n    this.loadCart();\n  }\n  handleError(error) {\n    let errorMessage = 'An error occurred';\n    if (error.error instanceof ErrorEvent) {\n      // Client-side error\n      errorMessage = error.error.message;\n    } else {\n      // Server-side error\n      errorMessage = `Error Code: ${error.status}\\nMessage: ${error.message}`;\n    }\n    console.error(errorMessage);\n    return throwError(() => new Error(errorMessage));\n  }\n  loadCart() {\n    this.http.get(this.apiUrl, this.httpOptions).subscribe({\n      next: items => {\n        console.log('Cart loaded:', items);\n        this.cartItemsSubject.next(items);\n        this.updateCartCount();\n        this.calculateTotal();\n      },\n      error: error => {\n        console.error('Error loading cart:', error);\n        this.cartItemsSubject.next([]);\n        this.updateCartCount();\n        this.calculateTotal();\n      }\n    });\n  }\n  addToCart(car, quantity = 1) {\n    console.log('Adding to cart:', {\n      car,\n      quantity\n    });\n    const payload = {\n      carId: car.id,\n      quantity: quantity\n    };\n    return this.http.post(this.apiUrl, payload, this.httpOptions).pipe(tap(response => {\n      console.log('Add to cart response:', response);\n      this.loadCart();\n    }), catchError(this.handleError));\n  }\n  updateQuantity(cartItemId, quantity) {\n    console.log('Updating quantity:', {\n      cartItemId,\n      quantity\n    });\n    const payload = {\n      quantity: quantity\n    };\n    return this.http.put(`${this.apiUrl}/${cartItemId}`, payload, this.httpOptions).pipe(tap(response => {\n      console.log('Update quantity response:', response);\n      this.loadCart();\n    }), catchError(this.handleError));\n  }\n  removeFromCart(cartItemId) {\n    console.log('Removing from cart:', cartItemId);\n    return this.http.delete(`${this.apiUrl}/${cartItemId}`, this.httpOptions).pipe(tap(response => {\n      console.log('Remove from cart response:', response);\n      this.loadCart();\n    }), catchError(this.handleError));\n  }\n  clearCart() {\n    console.log('Clearing cart');\n    return this.http.delete(`${this.apiUrl}/clear`, this.httpOptions).pipe(tap(response => {\n      console.log('Clear cart response:', response);\n      this.loadCart();\n    }), catchError(this.handleError));\n  }\n  updateCartCount() {\n    const totalItems = this.cartItemsSubject.value.reduce((sum, item) => sum + item.quantity, 0);\n    console.log('Updated cart count:', totalItems);\n    this.cartCountSubject.next(totalItems);\n  }\n  getCartItems() {\n    return this.cartItems$;\n  }\n  getTotalPrice() {\n    return this.totalPrice$;\n  }\n  calculateTotal() {\n    const total = this.cartItemsSubject.value.reduce((sum, item) => sum + item.car.price * item.quantity, 0);\n    console.log('Calculated total:', total);\n    this.totalPriceSubject.next(total);\n  }\n  static {\n    this.ɵfac = function CartService_Factory(t) {\n      return new (t || CartService)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: CartService,\n      factory: CartService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["HttpHeaders","BehaviorSubject","tap","catchError","throwError","environment","CartService","constructor","http","apiUrl","cartItemsSubject","cartItems$","asObservable","cartCountSubject","cartCount$","totalPriceSubject","totalPrice$","httpOptions","headers","withCredentials","loadCart","handleError","error","errorMessage","ErrorEvent","message","status","console","Error","get","subscribe","next","items","log","updateCartCount","calculateTotal","addToCart","car","quantity","payload","carId","id","post","pipe","response","updateQuantity","cartItemId","put","removeFromCart","delete","clearCart","totalItems","value","reduce","sum","item","getCartItems","getTotalPrice","total","price","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["C:\\angular project\\car\\frontend\\car-ecommerce-frontend\\src\\app\\services\\cart.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders, HttpErrorResponse } from '@angular/common/http';\r\nimport { BehaviorSubject, Observable, tap, catchError, throwError } from 'rxjs';\r\nimport { environment } from '../../environments/environment';\r\nimport { CartItem } from '../models/cart-item.model';\r\nimport { Car } from '../models/car.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class CartService {\r\n  private apiUrl = `${environment.apiUrl}/api/cart`;\r\n  private cartItemsSubject = new BehaviorSubject<CartItem[]>([]);\r\n  cartItems$ = this.cartItemsSubject.asObservable();\r\n  \r\n  private cartCountSubject = new BehaviorSubject<number>(0);\r\n  cartCount$ = this.cartCountSubject.asObservable();\r\n\r\n  private totalPriceSubject = new BehaviorSubject<number>(0);\r\n  totalPrice$ = this.totalPriceSubject.asObservable();\r\n\r\n  private httpOptions = {\r\n    headers: new HttpHeaders({\r\n      'Content-Type': 'application/json'\r\n    }),\r\n    withCredentials: true\r\n  };\r\n\r\n  constructor(private http: HttpClient) {\r\n    this.loadCart();\r\n  }\r\n\r\n  private handleError(error: HttpErrorResponse) {\r\n    let errorMessage = 'An error occurred';\r\n    if (error.error instanceof ErrorEvent) {\r\n      // Client-side error\r\n      errorMessage = error.error.message;\r\n    } else {\r\n      // Server-side error\r\n      errorMessage = `Error Code: ${error.status}\\nMessage: ${error.message}`;\r\n    }\r\n    console.error(errorMessage);\r\n    return throwError(() => new Error(errorMessage));\r\n  }\r\n\r\n  loadCart(): void {\r\n    this.http.get<CartItem[]>(this.apiUrl, this.httpOptions).subscribe({\r\n      next: (items) => {\r\n        console.log('Cart loaded:', items);\r\n        this.cartItemsSubject.next(items);\r\n        this.updateCartCount();\r\n        this.calculateTotal();\r\n      },\r\n      error: (error) => {\r\n        console.error('Error loading cart:', error);\r\n        this.cartItemsSubject.next([]);\r\n        this.updateCartCount();\r\n        this.calculateTotal();\r\n      }\r\n    });\r\n  }\r\n\r\n  addToCart(car: Car, quantity: number = 1): Observable<any> {\r\n    console.log('Adding to cart:', { car, quantity });\r\n    const payload = {\r\n      carId: car.id,\r\n      quantity: quantity\r\n    };\r\n\r\n    return this.http.post(this.apiUrl, payload, this.httpOptions).pipe(\r\n      tap((response) => {\r\n        console.log('Add to cart response:', response);\r\n        this.loadCart();\r\n      }),\r\n      catchError(this.handleError)\r\n    );\r\n  }\r\n\r\n  updateQuantity(cartItemId: number, quantity: number): Observable<any> {\r\n    console.log('Updating quantity:', { cartItemId, quantity });\r\n    const payload = { quantity: quantity };\r\n    return this.http.put(`${this.apiUrl}/${cartItemId}`, payload, this.httpOptions).pipe(\r\n      tap((response) => {\r\n        console.log('Update quantity response:', response);\r\n        this.loadCart();\r\n      }),\r\n      catchError(this.handleError)\r\n    );\r\n  }\r\n\r\n  removeFromCart(cartItemId: number): Observable<any> {\r\n    console.log('Removing from cart:', cartItemId);\r\n    return this.http.delete(`${this.apiUrl}/${cartItemId}`, this.httpOptions).pipe(\r\n      tap((response) => {\r\n        console.log('Remove from cart response:', response);\r\n        this.loadCart();\r\n      }),\r\n      catchError(this.handleError)\r\n    );\r\n  }\r\n\r\n  clearCart(): Observable<any> {\r\n    console.log('Clearing cart');\r\n    return this.http.delete(`${this.apiUrl}/clear`, this.httpOptions).pipe(\r\n      tap((response) => {\r\n        console.log('Clear cart response:', response);\r\n        this.loadCart();\r\n      }),\r\n      catchError(this.handleError)\r\n    );\r\n  }\r\n\r\n  private updateCartCount(): void {\r\n    const totalItems = this.cartItemsSubject.value.reduce(\r\n      (sum, item) => sum + item.quantity, 0\r\n    );\r\n    console.log('Updated cart count:', totalItems);\r\n    this.cartCountSubject.next(totalItems);\r\n  }\r\n\r\n  getCartItems(): Observable<CartItem[]> {\r\n    return this.cartItems$;\r\n  }\r\n\r\n  getTotalPrice(): Observable<number> {\r\n    return this.totalPrice$;\r\n  }\r\n\r\n  private calculateTotal(): void {\r\n    const total = this.cartItemsSubject.value.reduce(\r\n      (sum, item) => sum + (item.car.price * item.quantity), 0\r\n    );\r\n    console.log('Calculated total:', total);\r\n    this.totalPriceSubject.next(total);\r\n  }\r\n} "],"mappings":"AACA,SAAqBA,WAAW,QAA2B,sBAAsB;AACjF,SAASC,eAAe,EAAcC,GAAG,EAAEC,UAAU,EAAEC,UAAU,QAAQ,MAAM;AAC/E,SAASC,WAAW,QAAQ,gCAAgC;;;AAO5D,OAAM,MAAOC,WAAW;EAkBtBC,YAAoBC,IAAgB;IAAhB,KAAAA,IAAI,GAAJA,IAAI;IAjBhB,KAAAC,MAAM,GAAG,GAAGJ,WAAW,CAACI,MAAM,WAAW;IACzC,KAAAC,gBAAgB,GAAG,IAAIT,eAAe,CAAa,EAAE,CAAC;IAC9D,KAAAU,UAAU,GAAG,IAAI,CAACD,gBAAgB,CAACE,YAAY,EAAE;IAEzC,KAAAC,gBAAgB,GAAG,IAAIZ,eAAe,CAAS,CAAC,CAAC;IACzD,KAAAa,UAAU,GAAG,IAAI,CAACD,gBAAgB,CAACD,YAAY,EAAE;IAEzC,KAAAG,iBAAiB,GAAG,IAAId,eAAe,CAAS,CAAC,CAAC;IAC1D,KAAAe,WAAW,GAAG,IAAI,CAACD,iBAAiB,CAACH,YAAY,EAAE;IAE3C,KAAAK,WAAW,GAAG;MACpBC,OAAO,EAAE,IAAIlB,WAAW,CAAC;QACvB,cAAc,EAAE;OACjB,CAAC;MACFmB,eAAe,EAAE;KAClB;IAGC,IAAI,CAACC,QAAQ,EAAE;EACjB;EAEQC,WAAWA,CAACC,KAAwB;IAC1C,IAAIC,YAAY,GAAG,mBAAmB;IACtC,IAAID,KAAK,CAACA,KAAK,YAAYE,UAAU,EAAE;MACrC;MACAD,YAAY,GAAGD,KAAK,CAACA,KAAK,CAACG,OAAO;IACpC,CAAC,MAAM;MACL;MACAF,YAAY,GAAG,eAAeD,KAAK,CAACI,MAAM,cAAcJ,KAAK,CAACG,OAAO,EAAE;IACzE;IACAE,OAAO,CAACL,KAAK,CAACC,YAAY,CAAC;IAC3B,OAAOnB,UAAU,CAAC,MAAM,IAAIwB,KAAK,CAACL,YAAY,CAAC,CAAC;EAClD;EAEAH,QAAQA,CAAA;IACN,IAAI,CAACZ,IAAI,CAACqB,GAAG,CAAa,IAAI,CAACpB,MAAM,EAAE,IAAI,CAACQ,WAAW,CAAC,CAACa,SAAS,CAAC;MACjEC,IAAI,EAAGC,KAAK,IAAI;QACdL,OAAO,CAACM,GAAG,CAAC,cAAc,EAAED,KAAK,CAAC;QAClC,IAAI,CAACtB,gBAAgB,CAACqB,IAAI,CAACC,KAAK,CAAC;QACjC,IAAI,CAACE,eAAe,EAAE;QACtB,IAAI,CAACC,cAAc,EAAE;MACvB,CAAC;MACDb,KAAK,EAAGA,KAAK,IAAI;QACfK,OAAO,CAACL,KAAK,CAAC,qBAAqB,EAAEA,KAAK,CAAC;QAC3C,IAAI,CAACZ,gBAAgB,CAACqB,IAAI,CAAC,EAAE,CAAC;QAC9B,IAAI,CAACG,eAAe,EAAE;QACtB,IAAI,CAACC,cAAc,EAAE;MACvB;KACD,CAAC;EACJ;EAEAC,SAASA,CAACC,GAAQ,EAAEC,QAAA,GAAmB,CAAC;IACtCX,OAAO,CAACM,GAAG,CAAC,iBAAiB,EAAE;MAAEI,GAAG;MAAEC;IAAQ,CAAE,CAAC;IACjD,MAAMC,OAAO,GAAG;MACdC,KAAK,EAAEH,GAAG,CAACI,EAAE;MACbH,QAAQ,EAAEA;KACX;IAED,OAAO,IAAI,CAAC9B,IAAI,CAACkC,IAAI,CAAC,IAAI,CAACjC,MAAM,EAAE8B,OAAO,EAAE,IAAI,CAACtB,WAAW,CAAC,CAAC0B,IAAI,CAChEzC,GAAG,CAAE0C,QAAQ,IAAI;MACfjB,OAAO,CAACM,GAAG,CAAC,uBAAuB,EAAEW,QAAQ,CAAC;MAC9C,IAAI,CAACxB,QAAQ,EAAE;IACjB,CAAC,CAAC,EACFjB,UAAU,CAAC,IAAI,CAACkB,WAAW,CAAC,CAC7B;EACH;EAEAwB,cAAcA,CAACC,UAAkB,EAAER,QAAgB;IACjDX,OAAO,CAACM,GAAG,CAAC,oBAAoB,EAAE;MAAEa,UAAU;MAAER;IAAQ,CAAE,CAAC;IAC3D,MAAMC,OAAO,GAAG;MAAED,QAAQ,EAAEA;IAAQ,CAAE;IACtC,OAAO,IAAI,CAAC9B,IAAI,CAACuC,GAAG,CAAC,GAAG,IAAI,CAACtC,MAAM,IAAIqC,UAAU,EAAE,EAAEP,OAAO,EAAE,IAAI,CAACtB,WAAW,CAAC,CAAC0B,IAAI,CAClFzC,GAAG,CAAE0C,QAAQ,IAAI;MACfjB,OAAO,CAACM,GAAG,CAAC,2BAA2B,EAAEW,QAAQ,CAAC;MAClD,IAAI,CAACxB,QAAQ,EAAE;IACjB,CAAC,CAAC,EACFjB,UAAU,CAAC,IAAI,CAACkB,WAAW,CAAC,CAC7B;EACH;EAEA2B,cAAcA,CAACF,UAAkB;IAC/BnB,OAAO,CAACM,GAAG,CAAC,qBAAqB,EAAEa,UAAU,CAAC;IAC9C,OAAO,IAAI,CAACtC,IAAI,CAACyC,MAAM,CAAC,GAAG,IAAI,CAACxC,MAAM,IAAIqC,UAAU,EAAE,EAAE,IAAI,CAAC7B,WAAW,CAAC,CAAC0B,IAAI,CAC5EzC,GAAG,CAAE0C,QAAQ,IAAI;MACfjB,OAAO,CAACM,GAAG,CAAC,4BAA4B,EAAEW,QAAQ,CAAC;MACnD,IAAI,CAACxB,QAAQ,EAAE;IACjB,CAAC,CAAC,EACFjB,UAAU,CAAC,IAAI,CAACkB,WAAW,CAAC,CAC7B;EACH;EAEA6B,SAASA,CAAA;IACPvB,OAAO,CAACM,GAAG,CAAC,eAAe,CAAC;IAC5B,OAAO,IAAI,CAACzB,IAAI,CAACyC,MAAM,CAAC,GAAG,IAAI,CAACxC,MAAM,QAAQ,EAAE,IAAI,CAACQ,WAAW,CAAC,CAAC0B,IAAI,CACpEzC,GAAG,CAAE0C,QAAQ,IAAI;MACfjB,OAAO,CAACM,GAAG,CAAC,sBAAsB,EAAEW,QAAQ,CAAC;MAC7C,IAAI,CAACxB,QAAQ,EAAE;IACjB,CAAC,CAAC,EACFjB,UAAU,CAAC,IAAI,CAACkB,WAAW,CAAC,CAC7B;EACH;EAEQa,eAAeA,CAAA;IACrB,MAAMiB,UAAU,GAAG,IAAI,CAACzC,gBAAgB,CAAC0C,KAAK,CAACC,MAAM,CACnD,CAACC,GAAG,EAAEC,IAAI,KAAKD,GAAG,GAAGC,IAAI,CAACjB,QAAQ,EAAE,CAAC,CACtC;IACDX,OAAO,CAACM,GAAG,CAAC,qBAAqB,EAAEkB,UAAU,CAAC;IAC9C,IAAI,CAACtC,gBAAgB,CAACkB,IAAI,CAACoB,UAAU,CAAC;EACxC;EAEAK,YAAYA,CAAA;IACV,OAAO,IAAI,CAAC7C,UAAU;EACxB;EAEA8C,aAAaA,CAAA;IACX,OAAO,IAAI,CAACzC,WAAW;EACzB;EAEQmB,cAAcA,CAAA;IACpB,MAAMuB,KAAK,GAAG,IAAI,CAAChD,gBAAgB,CAAC0C,KAAK,CAACC,MAAM,CAC9C,CAACC,GAAG,EAAEC,IAAI,KAAKD,GAAG,GAAIC,IAAI,CAAClB,GAAG,CAACsB,KAAK,GAAGJ,IAAI,CAACjB,QAAS,EAAE,CAAC,CACzD;IACDX,OAAO,CAACM,GAAG,CAAC,mBAAmB,EAAEyB,KAAK,CAAC;IACvC,IAAI,CAAC3C,iBAAiB,CAACgB,IAAI,CAAC2B,KAAK,CAAC;EACpC;;;uBA5HWpD,WAAW,EAAAsD,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA;IAAA;EAAA;;;aAAXzD,WAAW;MAAA0D,OAAA,EAAX1D,WAAW,CAAA2D,IAAA;MAAAC,UAAA,EAFV;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}